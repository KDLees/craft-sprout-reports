{% extends "sproutreports/_layouts/base" %}
{% import "_includes/forms" as forms %}

{% set title = "Edit Report" %}

{% set crumbs = [
	{ label: "Reports"|t, url: url('sproutreports') },
	{ label: "Edit Report"|t, url: "" }
] %}

{# From Route #}
{% if reportId is defined %}
	{% set previouslySavedReport = craft.sproutReports.reportById(reportId) %}
{% endif %}

{# From failed POST request #}
{% if unsavedReport is defined and unsavedReport is not empty %}
	{% set report = unsavedReport %}
{% else %}
	{% set report = previouslySavedReport %}
{% endif %}

{% set response = craft.session.getFlash('response') %}

{% block content %}

	{% if response is not empty %}
	<h2 class="error">{{ response.message }}</h2>
	<p class="code notice">{{ response.dbMessage }}</p>
	{% endif %}

	{% if errorMessage is defined %}
	<h2 style="color: #d00;">{{ errorMessage }}</h2>
	{% endif %}

	<form method="post" action="" accept-charset="UTF-8">
		<input type="hidden" name="action" value="sproutReports/reports/saveReport">

		{% if reportId is defined %}
			<input type="hidden" name="id" value="{{ reportId }}">
		{% endif %}

		{{ forms.textField({
			label: "Name"|t,
			name: 'name',
			value: (report.name is defined) ? report.name : "",
			errors: "",
			required: true,
			first: true
		}) }}

		{{ forms.textField({
			label: "Handle"|t,
			name: 'handle',
			value: (report.handle is defined) ? report.handle : "",
			errors: "",
			required: true,
			first: true
		}) }}

		{{ forms.textareaField({
			label: "Description"|t,
			name: 'description',
			class: 'nicetext',
			rows: 4,
			value: (report.description is defined) ? report.description : ""
		}) }}

		{{ forms.textareaField({
			label: "Custom Query"|t,
			name: 'customQuery',
			class: 'code',
			value: (report.customQuery is defined) ? report.customQuery : "",
			rows: 10
		}) }}

		<div class="buttons">
			<input class="btn submit" type="submit" value="Save Report">
		</div>

		{% if reportId is defined %}
		<input type="button" class="btn small formsubmit" value="Delete" data-action="sproutReports/reports/deleteReport" data-confirm="Are you sure you want to delete this report?" data-redirect="sproutreports" tabindex="0">
		{% endif %}

	</form>

	{{ parent() }}

{% endblock %}